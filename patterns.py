import numpy as np
import re
import os
import sys
import importlib

lightning_bolt_bot = np.array([
    [0, 0, 0, 0, 0, 0, 0],  # 0
    [0, 0, 0, 0, 0, 1, 0],  # 1
    [0, 0, 0, 0, 1, 1, 0],  # 2
    [0, 0, 0, 1, 1, 0, 0],  # 3
    [0, 0, 1, 1, 1, 0, 0],  # 4
    [0, 1, 1, 1, 0, 0, 0],  # 5
    [0, 1, 1, 1, 1, 1, 0],  # 6
    [0, 0, 0, 1, 1, 1, 0],  # 7
    [0, 0, 1, 1, 1, 0, 0],  # 8
    [0, 0, 1, 1, 0, 0, 0],  # 9
    [0, 1, 1, 0, 0, 0, 0],  # 10
    [0, 1, 0, 0, 0, 0, 0],  # 11
    [0, 0, 0, 0, 0, 0, 0]],  # 12
    dtype=bool).T

# Cut out bottom row because top segment is one row shorter
lightning_bolt_top = np.array([
    [0, 0, 0, 0, 0, 0, 0],  # 0
    [0, 0, 0, 0, 0, 1, 0],  # 1
    [0, 0, 0, 0, 1, 1, 0],  # 2
    [0, 0, 0, 1, 1, 0, 0],  # 3
    [0, 0, 1, 1, 1, 0, 0],  # 4
    [0, 1, 1, 1, 0, 0, 0],  # 5
    [0, 1, 1, 1, 1, 1, 0],  # 6
    [0, 0, 0, 1, 1, 1, 0],  # 7
    [0, 0, 1, 1, 1, 0, 0],  # 8
    [0, 0, 1, 1, 0, 0, 0],  # 9
    [0, 1, 1, 0, 0, 0, 0],  # 10
    [0, 1, 0, 0, 0, 0, 0]],  # 11
    dtype=bool).T

# This table represents the 3x3 grid of LEDs to be drawn for each fill ratio
lookup_table = np.array(
    [
        [
            [0, 0, 0],
            [0, 0, 0],
            [0, 0, 0]
        ],
        [
            [0, 0, 0],
            [0, 1, 0],
            [0, 0, 0]
        ],
        [
            [0, 1, 0],
            [0, 1, 0],
            [0, 0, 0]
        ],
        [
            [0, 1, 1],
            [0, 1, 0],
            [0, 0, 0]
        ],
        [
            [0, 1, 1],
            [0, 1, 1],
            [0, 0, 0]
        ],
        [
            [0, 1, 1],
            [0, 1, 1],
            [0, 0, 1]
        ],
        [
            [0, 1, 1],
            [0, 1, 1],
            [0, 1, 1]
        ],
        [
            [0, 1, 1],
            [0, 1, 1],
            [1, 1, 1]
        ],
        [
            [0, 1, 1],
            [1, 1, 1],
            [1, 1, 1]
        ],
        [
            [1, 1, 1],
            [1, 1, 1],
            [1, 1, 1]
        ]
    ]
)

numerals = {
    '0': np.array([
        [0,0,0,1,1,1,0,0,0],
        [0,0,1,0,0,0,1,0,0],
        [0,0,1,0,0,1,1,0,0],
        [0,0,1,0,1,0,1,0,0],
        [0,0,1,1,0,0,1,0,0],
        [0,0,1,0,0,0,1,0,0],
        [0,0,0,1,1,1,0,0,0],
    ], dtype=bool),

    '1': np.array([
        [0,0,0,0,1,0,0,0,0],
        [0,0,0,1,1,0,0,0,0],
        [0,0,1,0,1,0,0,0,0],
        [0,0,0,0,1,0,0,0,0],
        [0,0,0,0,1,0,0,0,0],
        [0,0,0,0,1,0,0,0,0],
        [0,0,1,1,1,1,1,0,0],
    ], dtype=bool),

    '2': np.array([
        [0,0,0,1,1,1,0,0,0],
        [0,0,1,0,0,0,1,0,0],
        [0,0,0,0,0,0,1,0,0],
        [0,0,0,0,0,1,1,0,0],
        [0,0,0,0,1,0,0,0,0],
        [0,0,0,1,0,0,0,0,0],
        [0,0,1,1,1,1,1,0,0],
    ], dtype=bool),

    '3': np.array([
        [0,0,0,1,1,1,0,0,0],
        [0,0,1,0,0,0,1,0,0],
        [0,0,0,0,0,0,1,0,0],
        [0,0,0,1,1,1,0,0,0],
        [0,0,0,0,0,0,1,0,0],
        [0,0,1,0,0,0,1,0,0],
        [0,0,0,1,1,1,0,0,0],
    ], dtype=bool),

    '4': np.array([
        [0,0,0,0,0,1,0,0,0],
        [0,0,0,0,1,1,0,0,0],
        [0,0,0,1,0,1,0,0,0],
        [0,0,1,0,0,1,0,0,0],
        [0,0,1,1,1,1,1,0,0],
        [0,0,0,0,0,1,0,0,0],
        [0,0,0,0,0,1,0,0,0],
    ], dtype=bool),

    '5': np.array([
        [0,0,1,1,1,1,1,0,0],
        [0,0,1,0,0,0,0,0,0],
        [0,0,1,1,1,1,0,0,0],
        [0,0,0,0,0,0,1,0,0],
        [0,0,0,0,0,0,1,0,0],
        [0,0,1,0,0,0,1,0,0],
        [0,0,0,1,1,1,0,0,0],
    ], dtype=bool),

    '6': np.array([
        [0,0,0,0,1,1,0,0,0],
        [0,0,0,1,0,0,0,0,0],
        [0,0,1,0,0,0,0,0,0],
        [0,0,1,1,1,1,0,0,0],
        [0,0,1,0,0,0,1,0,0],
        [0,0,1,0,0,0,1,0,0],
        [0,0,0,1,1,1,0,0,0],
    ], dtype=bool),

    '7': np.array([
        [0,0,1,1,1,1,1,0,0],
        [0,0,0,0,0,0,1,0,0],
        [0,0,0,0,0,1,0,0,0],
        [0,0,0,0,1,0,0,0,0],
        [0,0,0,1,0,0,0,0,0],
        [0,0,0,1,0,0,0,0,0],
        [0,0,0,1,0,0,0,0,0],
    ], dtype=bool),

    '8': np.array([
        [0,0,0,1,1,1,0,0,0],
        [0,0,1,0,0,0,1,0,0],
        [0,0,1,0,0,0,1,0,0],
        [0,0,0,1,1,1,0,0,0],
        [0,0,1,0,0,0,1,0,0],
        [0,0,1,0,0,0,1,0,0],
        [0,0,0,1,1,1,0,0,0],
    ], dtype=bool),

    '9': np.array([
        [0,0,0,1,1,1,0,0,0],
        [0,0,1,0,0,0,1,0,0],
        [0,0,1,0,0,0,1,0,0],
        [0,0,0,1,1,1,1,0,0],
        [0,0,0,0,0,0,1,0,0],
        [0,0,0,0,0,1,0,0,0],
        [0,0,0,1,1,0,0,0,0],
    ], dtype=bool),
}

letters = {
    "A": np.array([
        [0,0,0,1,1,1,0,0,0],
        [0,0,1,0,0,0,1,0,0],
        [0,0,1,1,1,1,1,0,0],
        [0,0,1,0,0,0,1,0,0],
        [0,0,1,0,0,0,1,0,0],
        [0,0,1,0,0,0,1,0,0]], dtype=bool),

    "B": np.array([
        [0,0,1,1,1,1,0,0,0],
        [0,0,1,0,0,0,1,0,0],
        [0,0,1,1,1,1,0,0,0],
        [0,0,1,0,0,0,1,0,0],
        [0,0,1,0,0,0,1,0,0],
        [0,0,1,1,1,1,0,0,0]], dtype=bool),

    "C": np.array([
        [0,0,0,1,1,1,1,0,0],
        [0,0,1,0,0,0,0,0,0],
        [0,0,1,0,0,0,0,0,0],
        [0,0,1,0,0,0,0,0,0],
        [0,0,1,0,0,0,0,0,0],
        [0,0,0,1,1,1,1,0,0]], dtype=bool),

    "D": np.array([
        [0,0,1,1,1,0,0,0,0],
        [0,0,1,0,0,1,0,0,0],
        [0,0,1,0,0,0,1,0,0],
        [0,0,1,0,0,0,1,0,0],
        [0,0,1,0,0,1,0,0,0],
        [0,0,1,1,1,0,0,0,0]], dtype=bool),

    "E": np.array([
        [0,0,1,1,1,1,1,0,0],
        [0,0,1,0,0,0,0,0,0],
        [0,0,1,1,1,1,1,0,0],
        [0,0,1,0,0,0,0,0,0],
        [0,0,1,0,0,0,0,0,0],
        [0,0,1,1,1,1,1,0,0]], dtype=bool),

    "F": np.array([
        [0,0,1,1,1,1,1,0,0],
        [0,0,1,0,0,0,0,0,0],
        [0,0,1,1,1,1,0,0,0],
        [0,0,1,0,0,0,0,0,0],
        [0,0,1,0,0,0,0,0,0],
        [0,0,1,0,0,0,0,0,0]], dtype=bool),

    "G": np.array([
        [0,0,0,1,1,1,1,0,0],
        [0,0,1,0,0,0,0,0,0],
        [0,0,1,0,1,1,1,0,0],
        [0,0,1,0,0,0,1,0,0],
        [0,0,1,0,0,0,1,0,0],
        [0,0,0,1,1,1,1,0,0]], dtype=bool),

    "H": np.array([
        [0,0,1,0,0,0,1,0,0],
        [0,0,1,0,0,0,1,0,0],
        [0,0,1,1,1,1,1,0,0],
        [0,0,1,0,0,0,1,0,0],
        [0,0,1,0,0,0,1,0,0],
        [0,0,1,0,0,0,1,0,0]], dtype=bool),

    "I": np.array([
        [0,0,0,1,1,1,0,0,0],
        [0,0,0,0,1,0,0,0,0],
        [0,0,0,0,1,0,0,0,0],
        [0,0,0,0,1,0,0,0,0],
        [0,0,0,0,1,0,0,0,0],
        [0,0,0,1,1,1,0,0,0]], dtype=bool),

    "J": np.array([
        [0,0,0,1,1,1,0,0,0],
        [0,0,0,0,0,1,0,0,0],
        [0,0,0,0,0,1,0,0,0],
        [0,0,0,0,0,1,0,0,0],
        [0,0,1,0,0,1,0,0,0],
        [0,0,0,1,1,0,0,0,0]], dtype=bool),

    "K": np.array([
        [0,0,1,0,0,1,0,0,0],
        [0,0,1,0,1,0,0,0,0],
        [0,0,1,1,0,0,0,0,0],
        [0,0,1,1,0,0,0,0,0],
        [0,0,1,0,1,0,0,0,0],
        [0,0,1,0,0,1,0,0,0]], dtype=bool),

    "L": np.array([
        [0,0,1,0,0,0,0,0,0],
        [0,0,1,0,0,0,0,0,0],
        [0,0,1,0,0,0,0,0,0],
        [0,0,1,0,0,0,0,0,0],
        [0,0,1,0,0,0,0,0,0],
        [0,0,1,1,1,1,1,0,0]], dtype=bool),

    "M": np.array([
        [0,0,1,0,0,0,1,0,0],
        [0,0,1,1,0,1,1,0,0],
        [0,0,1,0,1,0,1,0,0],
        [0,0,1,0,0,0,1,0,0],
        [0,0,1,0,0,0,1,0,0],
        [0,0,1,0,0,0,1,0,0]], dtype=bool),

    "N": np.array([
        [0,0,1,0,0,0,1,0,0],
        [0,0,1,1,0,0,1,0,0],
        [0,0,1,0,1,0,1,0,0],
        [0,0,1,0,0,1,1,0,0],
        [0,0,1,0,0,0,1,0,0],
        [0,0,1,0,0,0,1,0,0]], dtype=bool),

    "O": np.array([
        [0,0,0,1,1,1,0,0,0],
        [0,0,1,0,0,0,1,0,0],
        [0,0,1,0,0,0,1,0,0],
        [0,0,1,0,0,0,1,0,0],
        [0,0,1,0,0,0,1,0,0],
        [0,0,0,1,1,1,0,0,0]], dtype=bool),

    "P": np.array([
        [0,0,1,1,1,1,0,0,0],
        [0,0,1,0,0,0,1,0,0],
        [0,0,1,1,1,1,0,0,0],
        [0,0,1,0,0,0,0,0,0],
        [0,0,1,0,0,0,0,0,0],
        [0,0,1,0,0,0,0,0,0]], dtype=bool),

    "Q": np.array([
        [0,0,0,1,1,1,0,0,0],
        [0,0,1,0,0,0,1,0,0],
        [0,0,1,0,0,0,1,0,0],
        [0,0,1,0,1,0,1,0,0],
        [0,0,0,1,1,1,0,0,0],
        [0,0,0,0,0,1,0,0,0]], dtype=bool),

    "R": np.array([
        [0,0,1,1,1,1,0,0,0],
        [0,0,1,0,0,1,0,0,0],
        [0,0,1,1,1,1,0,0,0],
        [0,0,1,1,0,0,0,0,0],
        [0,0,1,0,1,0,0,0,0],
        [0,0,1,0,0,1,0,0,0]], dtype=bool),

    "S": np.array([
        [0,0,0,1,1,1,1,0,0],
        [0,0,1,0,0,0,0,0,0],
        [0,0,0,1,1,1,0,0,0],
        [0,0,0,0,0,0,1,0,0],
        [0,0,1,0,0,0,1,0,0],
        [0,0,0,1,1,1,0,0,0]], dtype=bool),

    "T": np.array([
        [0,0,1,1,1,1,1,0,0],
        [0,0,0,0,1,0,0,0,0],
        [0,0,0,0,1,0,0,0,0],
        [0,0,0,0,1,0,0,0,0],
        [0,0,0,0,1,0,0,0,0],
        [0,0,0,0,1,0,0,0,0]], dtype=bool),

    "U": np.array([
        [0,0,1,0,0,0,1,0,0],
        [0,0,1,0,0,0,1,0,0],
        [0,0,1,0,0,0,1,0,0],
        [0,0,1,0,0,0,1,0,0],
        [0,0,1,0,0,0,1,0,0],
        [0,0,0,1,1,1,0,0,0]], dtype=bool),

    "V": np.array([
        [0,0,1,0,0,0,1,0,0],
        [0,0,1,0,0,0,1,0,0],
        [0,0,0,1,0,1,0,0,0],
        [0,0,0,1,0,1,0,0,0],
        [0,0,0,0,1,0,0,0,0],
        [0,0,0,0,1,0,0,0,0]], dtype=bool),

    "W": np.array([
        [0,0,1,0,0,0,1,0,0],
        [0,0,1,0,0,0,1,0,0],
        [0,0,1,0,1,0,1,0,0],
        [0,0,1,0,1,0,1,0,0],
        [0,0,0,1,0,1,0,0,0],
        [0,0,0,1,0,1,0,0,0]], dtype=bool),

    "X": np.array([
        [0,0,1,0,0,0,1,0,0],
        [0,0,0,1,0,1,0,0,0],
        [0,0,0,0,1,0,0,0,0],
        [0,0,0,0,1,0,0,0,0],
        [0,0,0,1,0,1,0,0,0],
        [0,0,1,0,0,0,1,0,0]], dtype=bool),

    "Y": np.array([
        [0,0,1,0,0,0,1,0,0],
        [0,0,0,1,0,1,0,0,0],
        [0,0,0,0,1,0,0,0,0],
        [0,0,0,0,1,0,0,0,0],
        [0,0,0,0,1,0,0,0,0],
        [0,0,0,0,1,0,0,0,0]], dtype=bool),

    "Z": np.array([
        [0,0,1,1,1,1,1,0,0],
        [0,0,0,0,0,1,0,0,0],
        [0,0,0,0,1,0,0,0,0],
        [0,0,0,1,0,0,0,0,0],
        [0,0,1,0,0,0,0,0,0],
        [0,0,1,1,1,1,1,0,0]], dtype=bool),
}


symbols = {
    "horiz_colon": np.array([
        [0,0,0,1,1,0,0,0,0]
    ], dtype=bool),

    "=": np.array([
        [0,0,0,0,0,0,0,0,0],
        [0,0,1,1,1,1,1,0,0],
        [0,0,0,0,0,0,0,0,0],
        [0,0,1,1,1,1,1,0,0],
        [0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0]
    ], dtype=bool),

    "-": np.array([
        [0,0,0,0,0,0,0,0,0],
        [0,0,0,1,1,1,0,0,0]
    ], dtype=bool),

    "+": np.array([
        [0,0,0,0,1,0,0,0,0],
        [0,0,0,0,1,0,0,0,0],
        [0,0,1,1,1,1,1,0,0],
        [0,0,0,0,1,0,0,0,0],
        [0,0,0,0,1,0,0,0,0],
        [0,0,0,0,0,0,0,0,0],
    ], dtype=bool),

    "?": np.array([
        [0,0,0,1,1,0,0,0,0],
        [0,0,0,0,0,1,0,0,0],
        [0,0,0,0,0,1,0,0,0],
        [0,0,0,0,1,0,0,0,0],
        [0,0,0,0,0,0,0,0,0],
        [0,0,0,0,1,0,0,0,0],
    ], dtype=bool),

    "degC": np.array([
        [0,0,1,1,0,0,0,0,0],
        [0,0,1,1,0,0,0,0,0],
        [0,0,0,0,1,1,1,0,0],
        [0,0,0,0,1,0,0,0,0],
        [0,0,0,0,1,0,0,0,0],
        [0,0,0,0,1,1,1,0,0],
    ], dtype=bool),

    "degF": np.array([
        [0,0,1,1,0,0,0,0,0],
        [0,0,1,1,0,0,0,0,0],
        [0,0,0,0,1,1,1,0,0],
        [0,0,0,0,1,0,0,0,0],
        [0,0,0,0,1,1,1,0,0],
        [0,0,0,0,1,0,0,0,0],
    ], dtype=bool),

    "degK": np.array([
        [0,0,1,1,0,0,0,0,0],
        [0,0,1,1,0,0,0,0,0],
        [0,0,0,0,1,0,0,0,0],
        [0,0,0,0,1,0,1,0,0],
        [0,0,0,0,1,1,0,0,0],
        [0,0,0,0,1,0,1,0,0],
    ], dtype=bool),
}
icons = {
    "pm_indicator": np.array([
        [1, 1],
        [1, 1]], dtype=bool),
    "clouds": np.array([
        [0,0,0,1,1,1,0,0,0],
        [0,0,1,1,1,1,1,0,0],
        [0,0,1,1,1,1,1,0,0],
        [0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0],
    ], dtype=bool),

    "rain": np.array([
        [0,0,0,1,1,1,0,0,0],
        [0,0,1,1,1,1,1,0,0],
        [0,0,1,1,1,1,1,0,0],
        [0,0,0,1,0,0,1,0,0],
        [0,0,0,0,1,0,0,0,0],
        [0,0,1,0,0,1,0,0,0],
    ], dtype=bool),

    "snow": np.array([
        [0,0,0,0,0,0,0,0,0],
        [0,0,1,0,0,0,1,0,0],
        [0,0,0,1,0,1,0,0,0],
        [0,0,1,1,1,1,1,0,0],
        [0,0,0,1,0,1,0,0,0],
        [0,0,1,0,0,0,1,0,0],
    ], dtype=bool),

    "clear": np.array([
        [0,0,0,0,1,0,0,0,0],
        [0,0,0,1,1,1,0,0,0],
        [0,0,1,1,1,1,1,0,0],
        [0,0,0,1,1,1,0,0,0],
        [0,0,0,0,1,0,0,0,0],
        [0,0,0,0,0,0,0,0,0],
    ], dtype=bool),

    "thunderstorm": np.array([
        [0,0,0,1,1,0,0,0,0],
        [0,0,1,1,1,1,1,0,0],
        [0,0,1,1,1,1,1,0,0],
        [0,0,0,0,1,0,0,0,0],
        [0,0,0,1,0,0,0,0,0],
        [0,0,0,0,1,0,0,0,0],
    ], dtype=bool),
}


id_patterns = {
    "cpu": np.array([
        [0, 0, 1, 1, 1, 0, 0],
        [0, 0, 1, 0, 0, 0, 0],
        [0, 0, 1, 0, 0, 0, 0],
        [0, 0, 1, 1, 1, 0, 0],
        [0, 0, 0, 0, 0, 0, 0],
        [0, 0, 1, 1, 0, 0, 0],
        [0, 0, 1, 0, 1, 0, 0],
        [0, 0, 1, 1, 0, 0, 0],
        [0, 0, 1, 0, 0, 0, 0],
        [0, 0, 1, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0],
        [0, 0, 1, 0, 1, 0, 0],
        [0, 0, 1, 0, 1, 0, 0],
        [0, 0, 1, 0, 1, 0, 0],
        [0, 0, 1, 1, 1, 0, 0]
    ]).T,
    "mem-bat": np.array([
        [0, 1, 1, 0, 1, 1, 0],
        [0, 1, 0, 1, 0, 1, 0],
        [0, 1, 0, 0, 0, 1, 0],
        [0, 1, 0, 0, 0, 1, 0],
        [0, 0, 0, 0, 0, 0, 0],
        [0, 0, 1, 1, 0, 0, 0],
        [0, 0, 1, 0, 1, 0, 0],
        [0, 0, 1, 1, 0, 0, 0],
        [0, 0, 1, 0, 1, 0, 0],
        [0, 0, 1, 1, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0],
        [0, 0, 1, 1, 1, 0, 0],
        [0, 0, 0, 1, 0, 0, 0],
        [0, 0, 0, 1, 0, 0, 0],
        [0, 0, 0, 1, 0, 0, 0],
    ]).T,
    "disk": np.array([
        [0, 0, 1, 1, 0, 0, 0],
        [0, 0, 1, 0, 1, 0, 0],
        [0, 0, 1, 0, 1, 0, 0],
        [0, 0, 1, 1, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0],
        [0, 0, 1, 1, 1, 0, 0],
        [0, 0, 1, 0, 0, 0, 0],
        [0, 0, 1, 1, 1, 0, 0],
        [0, 0, 0, 0, 1, 0, 0],
        [0, 0, 1, 1, 1, 0, 0],
        [0, 0, 0, 0, 0, 0, 0],
        [0, 0, 1, 0, 0, 0, 0],
        [0, 0, 1, 0, 1, 0, 0],
        [0, 0, 1, 1, 0, 0, 0],
        [0, 0, 1, 0, 1, 0, 0],
    ]).T,
    "net": np.array([
        [0, 0, 1, 0, 0, 1, 0],
        [0, 0, 1, 1, 0, 1, 0],
        [0, 0, 1, 0, 1, 1, 0],
        [0, 0, 1, 0, 0, 1, 0],
        [0, 0, 0, 0, 0, 0, 0],
        [0, 0, 1, 1, 1, 0, 0],
        [0, 0, 1, 0, 0, 0, 0],
        [0, 0, 1, 1, 0, 0, 0],
        [0, 0, 1, 0, 0, 0, 0],
        [0, 0, 1, 1, 1, 0, 0],
        [0, 0, 0, 0, 0, 0, 0],
        [0, 0, 1, 1, 1, 0, 0],
        [0, 0, 0, 1, 0, 0, 0],
        [0, 0, 0, 1, 0, 0, 0],
        [0, 0, 0, 1, 0, 0, 0],
    ]).T,
    "snap": np.concatenate((np.zeros((2,9)),
        letters["S"], np.zeros((2,9)), letters["N"], np.zeros((2,9)),letters["A"], np.zeros((2,9)), letters["P"], np.zeros((2,9)))).T
}
